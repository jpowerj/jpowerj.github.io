---
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'

import { cn } from 'astro-pure/utils'

interface Props {
  class?: string
  name?: string
  courses: {
    courseid: string
    name: string
    description: string
    href?: string
  }[]
}
const { class: className, courses, ...props } = Astro.props
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/projects/*.{jpeg,jpg,png,gif}'
)
---
<div class={cn(
    className,
    'grid gap-3',
  )}>
    {
      courses.map((course) => {
        var defaultImagePath = '/src/assets/projects/course-default.jpg'
        var imagePath = '/src/assets/projects/' + course.courseid + '.jpg'
        if (!images[imagePath]) {
          imagePath = defaultImagePath
        }
        if (!images[imagePath]) {
          throw new Error(`${imagePath} not found via glob`)
        }

        return (
          <a
            class={cn(
              className,
              'group overflow-hidden no-underline relative flex flex-col rounded-2xl border bg-muted ',
              course.href && 'transition-all hover:border-foreground/25 hover:shadow-sm'
            )}
            href={course.href || "https://github.com/jpowerj"}
            target='_blank'
          >
            <Image
              src={images[imagePath]()}
              alt={course.name}
              class='absolute top-0 h-70 w-full object-cover opacity-65 transition-opacity group-hover:opacity-100 dark:opacity-45'
              loading='lazy'
            />
            <div
              class='z-10 flex flex-col flex-grow items-start gap-y-0.5 bg-gradient-to-b from-transparent to-primary-foreground px-5 pb-4 pt-24'
            >
              <p class='text-lg font-medium mb-0'>{course.name}</p>
              <p class='text-muted-foreground'>{course.description}</p>
            </div>
          </a>
        )
      })
    }
  </div>
